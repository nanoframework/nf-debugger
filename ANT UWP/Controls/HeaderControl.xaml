<UserControl
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:NanoFramework.ANT.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:conv10="using:Template10.Converters"
    xmlns:utils="using:NanoFramework.ANT.Utilities"
    xmlns:views="using:NanoFramework.ANT.Views"
    xmlns:triggers="using:NanoFramework.ANT.StateTriggers"
    x:Class="NanoFramework.ANT.Controls.HeaderControl"
    mc:Ignorable="d"
    d:DesignHeight="48"
    d:DesignWidth="800"    
    Foreground="{ThemeResource AppTextColorBrush}">

    <UserControl.Resources>
        <!-- Converters -->
        <conv10:ValueWhenConverter x:Key="BooleanToVisibilityConverter">
            <conv10:ValueWhenConverter.When>
                <x:Boolean>True</x:Boolean>
            </conv10:ValueWhenConverter.When>
            <conv10:ValueWhenConverter.Value>
                <Visibility>Visible</Visibility>
            </conv10:ValueWhenConverter.Value>
            <conv10:ValueWhenConverter.Otherwise>
                <Visibility>Collapsed</Visibility>
            </conv10:ValueWhenConverter.Otherwise>
            <conv10:ValueWhenConverter.OtherwiseValueBack>
                <x:Boolean>False</x:Boolean>
            </conv10:ValueWhenConverter.OtherwiseValueBack>
        </conv10:ValueWhenConverter>

        <conv10:ValueWhenConverter x:Key="TrueWhenNotNullConverter" When="{x:Null}">
            <conv10:ValueWhenConverter.Value>
                <x:Boolean>False</x:Boolean>
            </conv10:ValueWhenConverter.Value>
            <conv10:ValueWhenConverter.Otherwise>
                <x:Boolean>True</x:Boolean>
            </conv10:ValueWhenConverter.Otherwise>
        </conv10:ValueWhenConverter>

        <conv10:ValueWhenConverter x:Key="BooleanInverterConverter">
            <conv10:ValueWhenConverter.When>
                <x:Boolean>True</x:Boolean>
            </conv10:ValueWhenConverter.When>
            <conv10:ValueWhenConverter.Value>
                <x:Boolean>False</x:Boolean>
            </conv10:ValueWhenConverter.Value>
            <conv10:ValueWhenConverter.Otherwise>
                <x:Boolean>True</x:Boolean>
            </conv10:ValueWhenConverter.Otherwise>
        </conv10:ValueWhenConverter>

        <conv10:ChangeTypeConverter x:Key="ChangeTypeConverter" />

        <DataTemplate x:Key="SerialTemplate">
            <Viewbox Height="32" Width="32"  >
                <Canvas Height="32" Width="32"  >
                    <Path Data="M 6 8 C 4.19196 8 2.77575 9.6475 3.03125 11.4375 L 4.46875 21.4375 C 4.67792 22.9092 5.95154 24 7.4375 24 L 24.5625 24 C 26.0485 24 27.3221 22.9092 27.5313 21.4375 L 28.9688 11.4375 C 29.2258 9.64722 27.808 8 26 8 L 6 8 Z M 6 10 L 26 10 C 26.628 10 27.089 10.5365 27 11.1563 L 25.5625 21.1563 C 25.4917 21.6546 25.0685 22 24.5625 22 L 7.4375 22 C 6.93146 22 6.50833 21.6546 6.4375 21.1563 L 5 11.1563 C 4.9115 10.5363 5.37204 10 6 10 Z M 8 13 C 7.44772 13 7 13.4477 7 14 C 7 14.5523 7.44772 15 8 15 C 8.55228 15 9 14.5523 9 14 C 9 13.4477 8.55228 13 8 13 Z M 12 13 C 11.4477 13 11 13.4477 11 14 C 11 14.5523 11.4477 15 12 15 C 12.5523 15 13 14.5523 13 14 C 13 13.4477 12.5523 13 12 13 Z M 16 13 C 15.4477 13 15 13.4477 15 14 C 15 14.5523 15.4477 15 16 15 C 16.5523 15 17 14.5523 17 14 C 17 13.4477 16.5523 13 16 13 Z M 20 13 C 19.4477 13 19 13.4477 19 14 C 19 14.5523 19.4477 15 20 15 C 20.5523 15 21 14.5523 21 14 C 21 13.4477 20.5523 13 20 13 Z M 24 13 C 23.4477 13 23 13.4477 23 14 C 23 14.5523 23.4477 15 24 15 C 24.5523 15 25 14.5523 25 14 C 25 13.4477 24.5523 13 24 13 Z M 10 17 C 9.44772 17 9 17.4477 9 18 C 9 18.5523 9.44772 19 10 19 C 10.5523 19 11 18.5523 11 18 C 11 17.4477 10.5523 17 10 17 Z M 14 17 C 13.4477 17 13 17.4477 13 18 C 13 18.5523 13.4477 19 14 19 C 14.5523 19 15 18.5523 15 18 C 15 17.4477 14.5523 17 14 17 Z M 18 17 C 17.4477 17 17 17.4477 17 18 C 17 18.5523 17.4477 19 18 19 C 18.5523 19 19 18.5523 19 18 C 19 17.4477 18.5523 17 18 17 Z M 22 17 C 21.4477 17 21 17.4477 21 18 C 21 18.5523 21.4477 19 22 19 C 22.5523 19 23 18.5523 23 18 C 23 17.4477 22.5523 17 22 17 Z" 
        				  Fill="{Binding Foreground, ElementName=ContentPresenter, Mode=OneWay}" />
                </Canvas>
            </Viewbox>
        </DataTemplate>

        <DataTemplate x:Key="UsbTemplate">
            <Viewbox Height="32" Width="32"  >
                <Canvas Height="32" Width="32"  >
                    <Path Data="M 9 5 L 9 6 L 9 14 L 8 14 C 6.35503 14 5 15.355 5 17 L 5 27 L 7 27 L 7 17 C 7 16.435 7.43497 16 8 16 L 24 16 C 24.565 16 25 16.435 25 17 L 25 27 L 27 27 L 27 17 C 27 15.355 25.645 14 24 14 L 23 14 L 23 6 L 23 5 L 22 5 L 10 5 L 9 5 Z M 11 7 L 21 7 L 21 14 L 11 14 L 11 7 Z M 13 9 L 13 11 L 15 11 L 15 9 L 13 9 Z M 17 9 L 17 11 L 19 11 L 19 9 L 17 9 Z" 
        				  Fill="{Binding Foreground, ElementName=ContentPresenter, Mode=OneWay}" />
                </Canvas>
            </Viewbox>
        </DataTemplate>

        <DataTemplate x:Key="NetworkTemplate">
            <Viewbox Height="32" Width="32"  >
                <Canvas Height="32" Width="32"  >
                    <Path Data="M 5 5 L 5 6 L 5 26 L 5 27 L 6 27 L 26 27 L 27 27 L 27 26 L 27 6 L 27 5 L 26 5 L 6 5 L 5 5 Z M 7 7 L 25 7 L 25 25 L 7 25 L 7 7 Z M 13 12 L 13 14 L 10 14 L 10 20 L 12 20 L 12 19 L 13 19 L 13 20 L 14 20 L 14 19 L 15 19 L 15 20 L 17 20 L 17 19 L 18 19 L 18 20 L 19 20 L 19 19 L 20 19 L 20 20 L 22 20 L 22 14 L 19 14 L 19 12 L 13 12 Z" 
        				  Fill="{Binding Foreground, ElementName=ContentPresenter, Mode=OneWay}" />
                </Canvas>
            </Viewbox>
        </DataTemplate>

        <utils:TransportTypeTemplateSelector x:Key="TransportTypeTemplateSelector" 
                                             SerialTemplate="{StaticResource SerialTemplate}" 
    		                                 UsbTemplate="{StaticResource UsbTemplate}"
    		                                 TcpIpTemplate="{StaticResource NetworkTemplate}"/>

        <Style  x:Key="FlyoutLisBoxItemStyle" TargetType="ListBoxItem">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="TabNavigation" Value="Local" />
            <Setter Property="Padding" Value="5" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="UseSystemFocusVisuals" Value="True" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Grid x:Name="LayoutRoot" Background="{TemplateBinding Background}" BorderThickness="{TemplateBinding BorderThickness}">
                            <Grid.Resources>
                                <Style x:Key="BaseContentPresenterStyle" TargetType="ContentPresenter">
                                    <Setter Property="FontFamily" Value="XamlAutoFontFamily" />
                                    <Setter Property="FontWeight" Value="SemiBold" />
                                    <Setter Property="FontSize" Value="15" />
                                    <Setter Property="TextWrapping" Value="Wrap" />
                                    <Setter Property="LineStackingStrategy" Value="MaxHeight" />
                                    <Setter Property="TextLineBounds" Value="Full" />
                                    <Setter Property="OpticalMarginAlignment" Value="TrimSideBearings" />
                                </Style>
                                <Style x:Key="BodyContentPresenterStyle" TargetType="ContentPresenter" BasedOn="{StaticResource BaseContentPresenterStyle}">
                                    <Setter Property="FontWeight" Value="Normal" />
                                    <Setter Property="FontSize" Value="15" />
                                </Style>
                            </Grid.Resources>
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup x:Name="CommonStates">
                                    <VisualState x:Name="Normal" />
                                    <VisualState x:Name="Disabled">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="ContentPresenter" Storyboard.TargetProperty="Foreground">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource SystemControlDisabledBaseMediumLowBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="Glyph" Storyboard.TargetProperty="Foreground">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource SystemControlDisabledBaseMediumLowBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="PointerOver">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="PressedBackground" Storyboard.TargetProperty="Fill">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource NavButtonHoverBackgroundBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="Pressed">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="PressedBackground" Storyboard.TargetProperty="Fill">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource NavButtonPressedBackgroundBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="SelectedUnfocused">
                                        <Storyboard>
                                            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="Glyph" Storyboard.TargetProperty="Opacity">
                                                <EasingDoubleKeyFrame KeyTime="0" Value="1" />
                                            </DoubleAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="SelectedPointerOver">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="PressedBackground" Storyboard.TargetProperty="Fill">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource NavButtonHoverBackgroundBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="Glyph" Storyboard.TargetProperty="Opacity">
                                                <EasingDoubleKeyFrame KeyTime="0" Value="1" />
                                            </DoubleAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="SelectedPressed">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="PressedBackground" Storyboard.TargetProperty="Fill">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource NavButtonPressedBackgroundBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="Glyph" Storyboard.TargetProperty="Opacity">
                                                <EasingDoubleKeyFrame KeyTime="0" Value="1" />
                                            </DoubleAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>

                            <Rectangle x:Name="PressedBackground" Fill="Transparent" Control.IsTemplateFocusTarget="True"/>
                            <StackPanel Orientation="Horizontal" 
                                        Margin="{TemplateBinding Padding}"
                                        HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                        VerticalAlignment="{TemplateBinding VerticalContentAlignment}">
                                <SymbolIcon x:Name="Glyph" Width="16" Height="16" Symbol="Accept" Opacity="0"/>
                                <ContentPresenter x:Name="ContentPresenter"
                                                    Content="{TemplateBinding Content}"
                                                    ContentTransitions="{TemplateBinding ContentTransitions}"
                                                    ContentTemplate="{TemplateBinding ContentTemplate}"
                                                    Style="{StaticResource BodyContentPresenterStyle}"
                                                    TextWrapping="NoWrap" Margin="5,0,0,0"                                                    
                                                     />
                            </StackPanel>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="HeaderButtonStyle" TargetType="Button">
            <Setter Property="Foreground" Value="{ThemeResource AppTextColorBrush}" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="HorizontalAlignment" Value="Left"/>
            <Setter Property="VerticalAlignment" Value="Stretch"/>
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontWeight" Value="Normal"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="UseSystemFocusVisuals" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid x:Name="RootGrid" Background="{TemplateBinding Background}">
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup x:Name="CommonStates">
                                    <VisualState x:Name="Normal">
                                        <Storyboard>
                                            <PointerUpThemeAnimation Storyboard.TargetName="RootGrid"/>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="PointerOver">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Background" Storyboard.TargetName="ContentPresenter">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource ButtonHeaderOverBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                            <PointerUpThemeAnimation Storyboard.TargetName="RootGrid"/>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="Pressed">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Foreground" Storyboard.TargetName="ContentPresenter">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource CustomColorDarkBrush}"  />
                                            </ObjectAnimationUsingKeyFrames>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Background" Storyboard.TargetName="ContentPresenter">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource ButtonHeaderOverBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                            <PointerUpThemeAnimation Storyboard.TargetName="RootGrid"/>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="Disabled">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Foreground" Storyboard.TargetName="ContentPresenter">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource SystemControlDisabledBaseLowBrush}"/>
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>
                            <ContentPresenter x:Name="ContentPresenter" 
                    		                AutomationProperties.AccessibilityView="Raw" 
                                            Background ="{TemplateBinding Background}"
                    		                BorderBrush="{TemplateBinding BorderBrush}" 
                    		                BorderThickness="1"
                    		                Content="{TemplateBinding Content}"
                    		                ContentTemplate="{TemplateBinding ContentTemplate}" 
                    		                ContentTransitions="{TemplateBinding ContentTransitions}"                                                                                             
                    		                HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}" 
                    		                Padding="{TemplateBinding Padding}" 
                    		                VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"/>

                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="HeaderButtonHighlightedStyle" TargetType="Button" BasedOn="{StaticResource HeaderButtonStyle}">
            <Setter Property="Background" Value="{ThemeResource ApplicationPageBackgroundThemeBrush}" />
            <Setter Property="Padding" Value="5,0" />
        </Style>

        <Style x:Key="PingButtonStyle" TargetType="Button" BasedOn="{StaticResource HeaderButtonStyle}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid x:Name="RootGrid" Background="{TemplateBinding Background}">
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup x:Name="CommonStates">
                                    <VisualState x:Name="Normal">
                                        <Storyboard>
                                            <PointerUpThemeAnimation Storyboard.TargetName="RootGrid"/>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="PointerOver">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Background" Storyboard.TargetName="ContentPresenter">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource ButtonHeaderOverBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                            <PointerUpThemeAnimation Storyboard.TargetName="RootGrid"/>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="Pressed">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Foreground" Storyboard.TargetName="ContentPresenter">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource CustomColorDarkBrush}"  />
                                            </ObjectAnimationUsingKeyFrames>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Background" Storyboard.TargetName="ContentPresenter">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource ButtonHeaderOverBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                            <PointerUpThemeAnimation Storyboard.TargetName="RootGrid"/>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="Disabled">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Foreground" Storyboard.TargetName="ContentPresenter">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource SystemControlDisabledBaseLowBrush}"/>
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>
                                <VisualStateGroup x:Name="PingStates">
                                    <VisualState x:Name="PingOkState">
                                        <VisualState.StateTriggers>
                                            <StateTrigger IsActive="{Binding Path=ConnectionResultOk}"/>
                                        </VisualState.StateTriggers>
                                        <Storyboard>
                                            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Opacity)" Storyboard.TargetName="PingOk">
                                                <EasingDoubleKeyFrame KeyTime="0" Value="1"/>
                                                <EasingDoubleKeyFrame KeyTime="0:0:2" Value="1"/>
                                                <EasingDoubleKeyFrame KeyTime="0:0:2.5" Value="0"/>
                                            </DoubleAnimationUsingKeyFrames>
                                            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Opacity)" Storyboard.TargetName="PingNormal">
                                                <EasingDoubleKeyFrame KeyTime="0" Value="0"/>
                                                <EasingDoubleKeyFrame KeyTime="0:0:2" Value="0"/>
                                                <EasingDoubleKeyFrame KeyTime="0:0:2.5" Value="1"/>
                                            </DoubleAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="PingErrorState">
                                        <VisualState.StateTriggers>
                                            <StateTrigger IsActive="{Binding Path=ConnectionResultError}"/>
                                        </VisualState.StateTriggers>
                                        <Storyboard>
                                            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Opacity)" Storyboard.TargetName="PingError">
                                                <EasingDoubleKeyFrame KeyTime="0" Value="1"/>
                                                <EasingDoubleKeyFrame KeyTime="0:0:2" Value="1"/>
                                                <EasingDoubleKeyFrame KeyTime="0:0:2.5" Value="0"/>
                                            </DoubleAnimationUsingKeyFrames>
                                            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Opacity)" Storyboard.TargetName="PingNormal">
                                                <EasingDoubleKeyFrame KeyTime="0" Value="0"/>
                                                <EasingDoubleKeyFrame KeyTime="0:0:2" Value="0"/>
                                                <EasingDoubleKeyFrame KeyTime="0:0:2.5" Value="1"/>
                                            </DoubleAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="PingBusyState">
                                        <VisualState.StateTriggers>
                                            <StateTrigger IsActive="{Binding Path=Pinging}"/>
                                        </VisualState.StateTriggers>
                                        <VisualState.Setters>
                                            <Setter Target="PingNormal.(UIElement.Opacity)" Value="0" />
                                            <Setter Target="PingBusy.(UIElement.Opacity)" Value="1" />
                                        </VisualState.Setters>
                                        <Storyboard RepeatBehavior="Forever">
                                            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.Rotation)" Storyboard.TargetName="refreshPath">
                                                <LinearDoubleKeyFrame  KeyTime="0" Value="0"/>
                                                <LinearDoubleKeyFrame  KeyTime="0:0:0.5" Value="90"/>
                                                <LinearDoubleKeyFrame  KeyTime="0:0:1" Value="180"/>
                                                <LinearDoubleKeyFrame  KeyTime="0:0:1.5" Value="270"/>
                                                <LinearDoubleKeyFrame  KeyTime="0:0:2" Value="360"/>
                                            </DoubleAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>
                            <ContentPresenter x:Name="ContentPresenter" 
        						            AutomationProperties.AccessibilityView="Raw" 
        						            Background ="{TemplateBinding Background}"
                                            Foreground="{TemplateBinding Foreground}"
        						            BorderBrush="{TemplateBinding BorderBrush}" 
        						            BorderThickness="1"        						       						
        						            ContentTransitions="{TemplateBinding ContentTransitions}"                                                                                             
        						            HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}" 
        						            Padding="{TemplateBinding Padding}" 
        						            VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}">
                                <Viewbox Height="32" Width="32"  >
                                    <Canvas Height="32" Width="32"  >
                                        <Canvas x:Name="PingNormal" Height="32" Width="32"  >
                                            <Path Data="M 5.40625 5.40625 C -0.442952 11.2555 -0.442952 20.7445 5.40625 26.5938 L 6.8125 25.1875 C 1.7277 20.1027 1.7277 11.8973 6.8125 6.8125 L 5.40625 5.40625 Z M 26.5938 5.40625 L 25.1875 6.8125 C 30.2723 11.8973 30.2723 20.1027 25.1875 25.1875 L 26.5938 26.5938 C 32.443 20.7445 32.443 11.2555 26.5938 5.40625 Z M 9.625 9.625 C 6.11878 13.1312 6.11878 18.8688 9.625 22.375 L 11.0625 20.9375 C 8.32072 18.1957 8.32072 13.8043 11.0625 11.0625 L 9.625 9.625 Z M 22.375 9.625 L 20.9375 11.0625 C 23.6793 13.8043 23.6793 18.1957 20.9375 20.9375 L 22.375 22.375 C 25.8812 18.8688 25.8812 13.1312 22.375 9.625 Z M 16 13 C 14.355 13 13 14.355 13 16 C 13 17.645 14.355 19 16 19 C 17.645 19 19 17.645 19 16 C 19 14.355 17.645 13 16 13 Z M 16 15 C 16.5641 15 17 15.4359 17 16 C 17 16.5641 16.5641 17 16 17 C 15.4359 17 15 16.5641 15 16 C 15 15.4359 15.4359 15 16 15 Z" 
                                                  Fill="{Binding Foreground, ElementName=ContentPresenter, Mode=OneWay}"  />
                                        </Canvas>
                                        <Canvas x:Name="PingOk" Height="32" Width="32" Opacity="0"  >
                                            <Path Data="M 5.40625 5.40625 C -0.442952 11.2555 -0.442952 20.74445 5.40625 26.59375 L 6.8125 25.1875 C 1.7277 20.1027 1.7277 11.8973 6.8125 6.8125 L 5.40625 5.40625 z M 26.59375 5.40625 L 25.1875 6.8125 C 28.204726 9.8297259 29.425511 13.944717 28.861328 17.855469 C 29.522523 18.080184 30.139287 18.397321 30.699219 18.792969 C 31.59146 14.090115 30.232782 9.0453134 26.59375 5.40625 z M 9.625 9.625 C 6.11878 13.1312 6.11878 18.8688 9.625 22.375 L 11.0625 20.9375 C 8.32072 18.1957 8.32072 13.8043 11.0625 11.0625 L 9.625 9.625 z M 22.375 9.625 L 20.9375 11.0625 C 23.041084 13.166084 23.520273 16.236273 22.394531 18.791016 C 23.121542 18.277907 23.946376 17.896846 24.835938 17.679688 C 25.370047 14.846756 24.555862 11.805862 22.375 9.625 z M 16 13 C 14.355 13 13 14.355 13 16 C 13 17.645 14.355 19 16 19 C 17.645 19 19 17.645 19 16 C 19 14.355 17.645 13 16 13 z M 16 15 C 16.5641 15 17 15.4359 17 16 C 17 16.5641 16.5641 17 16 17 C 15.4359 17 15 16.5641 15 16 C 15 15.4359 15.4359 15 16 15 z " 
                                                          Fill="{Binding Foreground, ElementName=ContentPresenter, Mode=OneWay}"   />

                                            <Path Data="M 26.03125 20.0625 C 22.740237 20.0625 20.0625 22.740237 20.0625 26.03125 C 20.0625 29.322281 22.740237 32 26.03125 32 C 29.322281 32 32 29.322281 32 26.03125 C 32 22.740237 29.322281 20.0625 26.03125 20.0625 z M 28.603516 23.53125 L 29.630859 24.529297 L 25.957031 28.185547 L 25.583984 28.546875 L 25.242188 28.197266 L 22.947266 25.902344 L 23.916016 24.902344 L 25.572266 26.550781 L 28.603516 23.53125 z " 
                                                          Fill="#00c100"  />
                                            <Path Data="M 28.603516 23.53125 L 25.572266 26.550781 L 23.916016 24.902344 L 22.947266 25.902344 L 25.242188 28.197266 L 25.583984 28.546875 L 25.957031 28.185547 L 29.630859 24.529297 L 28.603516 23.53125 z " 
                                                  Fill="#ffffff"  />
                                        </Canvas>
                                        <Canvas x:Name="PingError" Height="32" Width="32" Opacity="0"  >
                                            <Path Data="M 5.40625 5.40625 C -0.442952 11.2555 -0.442952 20.74445 5.40625 26.59375 L 6.8125 25.1875 C 1.7277 20.1027 1.7277 11.8973 6.8125 6.8125 L 5.40625 5.40625 z M 26.59375 5.40625 L 25.1875 6.8125 C 28.139062 9.7640622 29.365636 13.765801 28.890625 17.599609 C 29.552661 17.822748 30.179009 18.120198 30.761719 18.484375 C 31.533848 13.870025 30.152831 8.9653615 26.59375 5.40625 z M 9.625 9.625 C 6.11878 13.1312 6.11878 18.8688 9.625 22.375 L 11.0625 20.9375 C 8.32072 18.1957 8.32072 13.8043 11.0625 11.0625 L 9.625 9.625 z M 22.375 9.625 L 20.9375 11.0625 C 22.764644 12.889644 23.367851 15.447757 22.759766 17.763672 C 23.440704 17.492277 24.163251 17.305151 24.914062 17.208984 C 25.274526 14.513708 24.434879 11.684879 22.375 9.625 z M 16 13 C 14.355 13 13 14.355 13 16 C 13 17.645 14.355 19 16 19 C 17.645 19 19 17.645 19 16 C 19 14.355 17.645 13 16 13 z M 16 15 C 16.5641 15 17 15.4359 17 16 C 17 16.5641 16.5641 17 16 17 C 15.4359 17 15 16.5641 15 16 C 15 15.4359 15.4359 15 16 15 z " 
                                                          Fill="{Binding Foreground, ElementName=ContentPresenter, Mode=OneWay}"  />

                                            <Path Data="M 26.050781 20.101562 C 22.770574 20.101562 20.101562 22.770574 20.101562 26.050781 C 20.101562 29.331007 22.770574 32 26.050781 32 C 29.331007 32 32 29.331007 32 26.050781 C 32 22.770574 29.331007 20.101562 26.050781 20.101562 z M 28.345703 22.664062 L 29.326172 23.654297 L 26.996094 25.96875 L 29.425781 28.390625 L 28.447266 29.347656 L 26.042969 26.955078 L 23.662109 29.306641 L 22.664062 28.318359 L 25.044922 25.964844 L 22.779297 23.689453 L 23.748047 22.730469 L 26.001953 24.984375 L 28.345703 22.664062 z " 
                                                  Fill="#ff0000"  />
                                            <Path Data="M 28.345703 22.664062 L 26.001953 24.984375 L 23.748047 22.730469 L 22.779297 23.689453 L 25.044922 25.964844 L 22.664062 28.318359 L 23.662109 29.306641 L 26.042969 26.955078 L 28.447266 29.347656 L 29.425781 28.390625 L 26.996094 25.96875 L 29.326172 23.654297 L 28.345703 22.664062 z " 
                                                  Fill="#ffffff"  />
                                        </Canvas>
                                        <Canvas x:Name="PingBusy" Height="32" Width="32"  Opacity="0">
                                            <Path Data="M 5.40625 5.40625 C -0.442952 11.2555 -0.442952 20.7445 5.40625 26.5938 L 6.8125 25.1875 C 1.7277 20.1027 1.7277 11.8973 6.8125 6.8125 L 5.40625 5.40625 Z M 26.5938 5.40625 L 25.1875 6.8125 C 30.2723 11.8973 30.2723 20.1027 25.1875 25.1875 L 26.5938 26.5938 C 32.443 20.7445 32.443 11.2555 26.5938 5.40625 Z M 9.625 9.625 C 6.11878 13.1312 6.11878 18.8688 9.625 22.375 L 11.0625 20.9375 C 8.32072 18.1957 8.32072 13.8043 11.0625 11.0625 L 9.625 9.625 Z M 22.375 9.625 L 20.9375 11.0625 C 23.6793 13.8043 23.6793 18.1957 20.9375 20.9375 L 22.375 22.375 C 25.8812 18.8688 25.8812 13.1312 22.375 9.625 Z M 16 13 C 14.355 13 13 14.355 13 16 C 13 17.645 14.355 19 16 19 C 17.645 19 19 17.645 19 16 C 19 14.355 17.645 13 16 13 Z M 16 15 C 16.5641 15 17 15.4359 17 16 C 17 16.5641 16.5641 17 16 17 C 15.4359 17 15 16.5641 15 16 C 15 15.4359 15.4359 15 16 15 Z" 
                                                  Fill="{ThemeResource SystemControlDisabledBaseLowBrush}" />
                                            <Path x:Name="refreshPath" Data="M 26.4375 20 C 23.88185 20 21.746005 21.580545 20.875 23.8125 L 21.796875 24.1875 C 22.52587 22.319455 24.29315 21 26.4375 21 C 28.0577 21 29.5043 21.79478 30.40625 23 L 28.4375 23 L 28.4375 24 L 31.4375 24 L 31.9375 24 L 31.9375 23.5 L 31.9375 20.5 L 30.9375 20.5 L 30.9375 22.046875 C 29.8425 20.790415 28.22295 20 26.4375 20 z M 31.078125 27.8125 C 30.349125 29.68055 28.58185 31 26.4375 31 C 24.79925 31 23.359215 30.19415 22.453125 29 L 24.4375 29 L 24.4375 28 L 21.4375 28 L 20.9375 28 L 20.9375 28.5 L 20.9375 31.5 L 21.9375 31.5 L 21.9375 29.953125 C 23.03179 31.192725 24.6348 32 26.4375 32 C 28.99315 32 31.129 30.41945 32 28.1875 L 31.078125 27.8125 z " 
                                                  Fill="{ThemeResource ButtonHeaderBusyBrush}"   >
                                                <Path.RenderTransform>
                                                    <CompositeTransform CenterX="26" CenterY="26"/>
                                                </Path.RenderTransform>
                                            </Path>
                                        </Canvas>
                                    </Canvas>
                                </Viewbox>
                            </ContentPresenter>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ConnectDisconnectButtonStyle" TargetType="Button" BasedOn="{StaticResource HeaderButtonStyle}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid x:Name="RootGrid" Background="{TemplateBinding Background}">
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup x:Name="CommonStates">
                                    <VisualState x:Name="Normal">
                                        <Storyboard>
                                            <PointerUpThemeAnimation Storyboard.TargetName="RootGrid"/>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="PointerOver">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Background" Storyboard.TargetName="ContentPresenter">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource ButtonHeaderOverBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                            <PointerUpThemeAnimation Storyboard.TargetName="RootGrid"/>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="Pressed">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Foreground" Storyboard.TargetName="ContentPresenter">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource CustomColorDarkBrush}"  />
                                            </ObjectAnimationUsingKeyFrames>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Background" Storyboard.TargetName="ContentPresenter">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource ButtonHeaderOverBrush}" />
                                            </ObjectAnimationUsingKeyFrames>
                                            <PointerUpThemeAnimation Storyboard.TargetName="RootGrid"/>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="Disabled">
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Foreground" Storyboard.TargetName="ContentPresenter">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{ThemeResource SystemControlDisabledBaseLowBrush}"/>
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>
                                <VisualStateGroup x:Name="CommandStates">
                                    <VisualState x:Name="ConnectedState">
                                        <VisualState.StateTriggers>
                                            <StateTrigger IsActive="{Binding Path=Connected, Mode=OneWay}"/>
                                        </VisualState.StateTriggers>
                                    </VisualState>
                                    <VisualState x:Name="DisconnectedState">
                                        <VisualState.StateTriggers>
                                            <StateTrigger IsActive="{Binding Path=Disconnected, Mode=OneWay}"/>
                                        </VisualState.StateTriggers>
                                        <Storyboard>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Opacity)" Storyboard.TargetName="Connect">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="0"/>
                                            </ObjectAnimationUsingKeyFrames>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Opacity)" Storyboard.TargetName="Disconnect">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="1"/>
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="ConnectingState">
                                        <VisualState.StateTriggers>
                                            <StateTrigger IsActive="{Binding Path=Connecting, Mode=OneWay}"/>
                                        </VisualState.StateTriggers>
                                        <VisualState.Setters>
                                            <Setter Target="Connect.(UIElement.Opacity)" Value="0" />
                                            <Setter Target="ConnectBusy.(UIElement.Opacity)" Value="1" />
                                        </VisualState.Setters>
                                        <Storyboard RepeatBehavior="Forever">
                                            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.Rotation)" Storyboard.TargetName="ConnectRefreshPath">
                                                <LinearDoubleKeyFrame  KeyTime="0" Value="0"/>
                                                <LinearDoubleKeyFrame  KeyTime="0:0:0.5" Value="90"/>
                                                <LinearDoubleKeyFrame  KeyTime="0:0:1" Value="180"/>
                                                <LinearDoubleKeyFrame  KeyTime="0:0:1.5" Value="270"/>
                                                <LinearDoubleKeyFrame  KeyTime="0:0:2" Value="360"/>
                                            </DoubleAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="DisconnectingState">
                                        <VisualState.StateTriggers>
                                            <StateTrigger IsActive="{Binding Path=Disconnecting, Mode=OneWay}"/>
                                        </VisualState.StateTriggers>
                                        <VisualState.Setters>
                                            <Setter Target="Connect.(UIElement.Opacity)" Value="0" />
                                            <Setter Target="DisconnectBusy.(UIElement.Opacity)" Value="1" />
                                        </VisualState.Setters>
                                        <Storyboard RepeatBehavior="Forever">
                                            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.Rotation)" Storyboard.TargetName="DisconnectRefreshPath">
                                                <LinearDoubleKeyFrame  KeyTime="0" Value="0"/>
                                                <LinearDoubleKeyFrame  KeyTime="0:0:0.5" Value="90"/>
                                                <LinearDoubleKeyFrame  KeyTime="0:0:1" Value="180"/>
                                                <LinearDoubleKeyFrame  KeyTime="0:0:1.5" Value="270"/>
                                                <LinearDoubleKeyFrame  KeyTime="0:0:2" Value="360"/>
                                            </DoubleAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>

                            </VisualStateManager.VisualStateGroups>
                            <ContentPresenter x:Name="ContentPresenter" 
        						              AutomationProperties.AccessibilityView="Raw" 
        						              Background ="{TemplateBinding Background}"
                                              Foreground="{TemplateBinding Foreground}"
        						              BorderBrush="{TemplateBinding BorderBrush}" 
        						              BorderThickness="1"        						
        						              ContentTransitions="{TemplateBinding ContentTransitions}"                                                                                             
        						              HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}" 
        						              Padding="{TemplateBinding Padding}" 
        						              VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}">
                                <Viewbox Height="32" Width="32"  >
                                    <Canvas x:Name="canvas"  Height="32" Width="32"  >
                                        <Canvas x:Name="Connect" Height="32" Width="32"  >
                                            <Path Data="M 24.7813 5.78125 L 22.125 8.4375 L 21.6875 7.96875 C 20.7154 6.99664 19.438 6.5 18.1563 6.5 C 16.8745 6.5 15.5971 6.99664 14.625 7.96875 L 13.9063 8.65625 L 13 9.5625 L 12.2188 8.78125 L 10.7813 10.2188 L 21.7813 21.2188 L 23.2188 19.7813 L 22.4375 19 L 24.0313 17.375 C 25.9755 15.4308 25.9755 12.2567 24.0313 10.3125 L 23.5625 9.875 L 26.2188 7.21875 L 24.7813 5.78125 Z M 18.1563 8.5 C 18.9238 8.5 19.6914 8.78511 20.2813 9.375 L 22.625 11.7188 C 23.8048 12.8985 23.8048 14.789 22.625 15.9688 L 21 17.5625 L 14.4375 11 L 16.0313 9.375 C 16.6211 8.78511 17.3887 8.5 18.1563 8.5 Z M 10.2188 10.7813 L 8.78125 12.2188 L 9.5625 13 L 8.65625 13.9063 L 7.96875 14.625 C 6.02453 16.5692 6.02453 19.7433 7.96875 21.6875 L 8.40625 22.1563 L 5.78125 24.7813 L 7.21875 26.2188 L 9.84375 23.5938 L 10.3125 24.0313 C 12.2567 25.9755 15.4308 25.9755 17.375 24.0313 L 19 22.4375 L 19.7813 23.2188 L 21.2188 21.7813 L 10.2188 10.7813 Z M 11 14.4375 L 17.5625 21 L 15.9688 22.625 C 14.789 23.8048 12.8985 23.8048 11.7188 22.625 L 9.375 20.2813 C 8.19522 19.1015 8.19522 17.211 9.375 16.0313 L 11 14.4375 Z" 
                                                  Fill="{Binding Foreground, ElementName=ContentPresenter, Mode=OneWay}"  />
                                        </Canvas>
                                        <Canvas x:Name="ConnectBusy" Height="32" Width="32"  Opacity="0">
                                            <Path Data="M 24.7813 5.78125 L 22.125 8.4375 L 21.6875 7.96875 C 20.7154 6.99664 19.438 6.5 18.1563 6.5 C 16.8745 6.5 15.5971 6.99664 14.625 7.96875 L 13.9063 8.65625 L 13 9.5625 L 12.2188 8.78125 L 10.7813 10.2188 L 21.7813 21.2188 L 23.2188 19.7813 L 22.4375 19 L 24.0313 17.375 C 25.9755 15.4308 25.9755 12.2567 24.0313 10.3125 L 23.5625 9.875 L 26.2188 7.21875 L 24.7813 5.78125 Z M 18.1563 8.5 C 18.9238 8.5 19.6914 8.78511 20.2813 9.375 L 22.625 11.7188 C 23.8048 12.8985 23.8048 14.789 22.625 15.9688 L 21 17.5625 L 14.4375 11 L 16.0313 9.375 C 16.6211 8.78511 17.3887 8.5 18.1563 8.5 Z M 10.2188 10.7813 L 8.78125 12.2188 L 9.5625 13 L 8.65625 13.9063 L 7.96875 14.625 C 6.02453 16.5692 6.02453 19.7433 7.96875 21.6875 L 8.40625 22.1563 L 5.78125 24.7813 L 7.21875 26.2188 L 9.84375 23.5938 L 10.3125 24.0313 C 12.2567 25.9755 15.4308 25.9755 17.375 24.0313 L 19 22.4375 L 19.7813 23.2188 L 21.2188 21.7813 L 10.2188 10.7813 Z M 11 14.4375 L 17.5625 21 L 15.9688 22.625 C 14.789 23.8048 12.8985 23.8048 11.7188 22.625 L 9.375 20.2813 C 8.19522 19.1015 8.19522 17.211 9.375 16.0313 L 11 14.4375 Z" 
                                                  Fill="{ThemeResource SystemControlDisabledBaseLowBrush}"  />
                                            <Path x:Name="ConnectRefreshPath" Data="M 26.4375 20 C 23.88185 20 21.746005 21.580545 20.875 23.8125 L 21.796875 24.1875 C 22.52587 22.319455 24.29315 21 26.4375 21 C 28.0577 21 29.5043 21.79478 30.40625 23 L 28.4375 23 L 28.4375 24 L 31.4375 24 L 31.9375 24 L 31.9375 23.5 L 31.9375 20.5 L 30.9375 20.5 L 30.9375 22.046875 C 29.8425 20.790415 28.22295 20 26.4375 20 z M 31.078125 27.8125 C 30.349125 29.68055 28.58185 31 26.4375 31 C 24.79925 31 23.359215 30.19415 22.453125 29 L 24.4375 29 L 24.4375 28 L 21.4375 28 L 20.9375 28 L 20.9375 28.5 L 20.9375 31.5 L 21.9375 31.5 L 21.9375 29.953125 C 23.03179 31.192725 24.6348 32 26.4375 32 C 28.99315 32 31.129 30.41945 32 28.1875 L 31.078125 27.8125 z " 
                                                  Fill="{ThemeResource ButtonHeaderBusyBrush}"   >
                                                <Path.RenderTransform>
                                                    <CompositeTransform CenterX="26" CenterY="26"/>
                                                </Path.RenderTransform>
                                            </Path>
                                        </Canvas>
                                        <Canvas x:Name="Disconnect" Height="32" Width="32" Opacity="0"  >
                                            <Path Data="M 27.2813 3.28125 L 24.625 5.9375 L 24.1875 5.46875 C 23.2154 4.49664 21.938 4 20.6563 4 C 19.3745 4 18.0971 4.49664 17.125 5.46875 L 16.4063 6.15625 L 15.5 7.0625 L 14.7188 6.28125 L 13.2813 7.71875 L 16.0625 10.5 L 13.2813 13.2813 L 14.7188 14.7188 L 17.5 11.9375 L 20.0625 14.5 L 17.2813 17.2813 L 18.7188 18.7188 L 21.5 15.9375 L 24.2813 18.7188 L 25.7188 17.2813 L 24.9375 16.5 L 26.5313 14.875 C 28.4755 12.9308 28.4755 9.75672 26.5313 7.8125 L 26.0625 7.375 L 28.7188 4.71875 L 27.2813 3.28125 Z M 20.6563 6 C 21.4238 6 22.1914 6.28511 22.7813 6.875 L 25.125 9.21875 C 26.3048 10.3985 26.3048 12.289 25.125 13.4688 L 24.875 13.6875 L 23.5 15.0625 L 16.9375 8.5 L 18.5313 6.875 C 19.1211 6.28511 19.8887 6 20.6563 6 Z M 7.71875 13.2813 L 6.28125 14.7188 L 7.0625 15.5 L 5.46875 17.125 C 3.52453 19.0692 3.52453 22.2433 5.46875 24.1875 L 5.90625 24.6563 L 3.28125 27.2813 L 4.71875 28.7188 L 7.34375 26.0938 L 7.8125 26.5313 C 9.75672 28.4755 12.9308 28.4755 14.875 26.5313 L 16.5 24.9375 L 17.2813 25.7188 L 18.7188 24.2813 L 7.71875 13.2813 Z M 8.5 16.9375 L 15.0625 23.5 L 13.4688 25.125 C 12.289 26.3048 10.3985 26.3048 9.21875 25.125 L 9 24.875 L 6.875 22.7813 C 5.69522 21.6015 5.69522 19.711 6.875 18.5313 L 8.5 16.9375 Z" 
                                                  Fill="{Binding Foreground, ElementName=ContentPresenter, Mode=OneWay}"  />
                                        </Canvas>
                                        <Canvas x:Name="DisconnectBusy" Height="32" Width="32"  Opacity="0">
                                            <Path Data="M 27.2813 3.28125 L 24.625 5.9375 L 24.1875 5.46875 C 23.2154 4.49664 21.938 4 20.6563 4 C 19.3745 4 18.0971 4.49664 17.125 5.46875 L 16.4063 6.15625 L 15.5 7.0625 L 14.7188 6.28125 L 13.2813 7.71875 L 16.0625 10.5 L 13.2813 13.2813 L 14.7188 14.7188 L 17.5 11.9375 L 20.0625 14.5 L 17.2813 17.2813 L 18.7188 18.7188 L 21.5 15.9375 L 24.2813 18.7188 L 25.7188 17.2813 L 24.9375 16.5 L 26.5313 14.875 C 28.4755 12.9308 28.4755 9.75672 26.5313 7.8125 L 26.0625 7.375 L 28.7188 4.71875 L 27.2813 3.28125 Z M 20.6563 6 C 21.4238 6 22.1914 6.28511 22.7813 6.875 L 25.125 9.21875 C 26.3048 10.3985 26.3048 12.289 25.125 13.4688 L 24.875 13.6875 L 23.5 15.0625 L 16.9375 8.5 L 18.5313 6.875 C 19.1211 6.28511 19.8887 6 20.6563 6 Z M 7.71875 13.2813 L 6.28125 14.7188 L 7.0625 15.5 L 5.46875 17.125 C 3.52453 19.0692 3.52453 22.2433 5.46875 24.1875 L 5.90625 24.6563 L 3.28125 27.2813 L 4.71875 28.7188 L 7.34375 26.0938 L 7.8125 26.5313 C 9.75672 28.4755 12.9308 28.4755 14.875 26.5313 L 16.5 24.9375 L 17.2813 25.7188 L 18.7188 24.2813 L 7.71875 13.2813 Z M 8.5 16.9375 L 15.0625 23.5 L 13.4688 25.125 C 12.289 26.3048 10.3985 26.3048 9.21875 25.125 L 9 24.875 L 6.875 22.7813 C 5.69522 21.6015 5.69522 19.711 6.875 18.5313 L 8.5 16.9375 Z" 
                                                  Fill="{ThemeResource SystemControlDisabledBaseLowBrush}"  />
                                            <Path x:Name="DisconnectRefreshPath" Data="M 26.4375 20 C 23.88185 20 21.746005 21.580545 20.875 23.8125 L 21.796875 24.1875 C 22.52587 22.319455 24.29315 21 26.4375 21 C 28.0577 21 29.5043 21.79478 30.40625 23 L 28.4375 23 L 28.4375 24 L 31.4375 24 L 31.9375 24 L 31.9375 23.5 L 31.9375 20.5 L 30.9375 20.5 L 30.9375 22.046875 C 29.8425 20.790415 28.22295 20 26.4375 20 z M 31.078125 27.8125 C 30.349125 29.68055 28.58185 31 26.4375 31 C 24.79925 31 23.359215 30.19415 22.453125 29 L 24.4375 29 L 24.4375 28 L 21.4375 28 L 20.9375 28 L 20.9375 28.5 L 20.9375 31.5 L 21.9375 31.5 L 21.9375 29.953125 C 23.03179 31.192725 24.6348 32 26.4375 32 C 28.99315 32 31.129 30.41945 32 28.1875 L 31.078125 27.8125 z " 
                                                  Fill="{ThemeResource ButtonHeaderBusyBrush}"   >
                                                <Path.RenderTransform>
                                                    <CompositeTransform CenterX="26" CenterY="26"/>
                                                </Path.RenderTransform>
                                            </Path>
                                        </Canvas>
                                    </Canvas>
                                </Viewbox>
                            </ContentPresenter>

                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

    </UserControl.Resources>

    <UserControl.DataContext>
        <Binding Mode="OneWay" Path="MainViewModel" Source="{StaticResource Locator}"/>
    </UserControl.DataContext>

    <Grid Padding="0" Background="{StaticResource LigtherAreaBrush}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Button x:Name="AvailableDevicesButton" Grid.Row="0" Grid.Column="0"
                Style="{StaticResource HeaderButtonHighlightedStyle}" HorizontalAlignment="Right" VerticalAlignment="Stretch" Width="250"
                Content="{x:Bind ViewModel.SelectedDeviceDisplayContent, Mode=OneWay}" Margin="0,0,5,0" Height="40"
                IsEnabled="{x:Bind ViewModel.IsBusyHeader, Converter={StaticResource BooleanInverterConverter}, Mode=OneWay}">
            <Button.Flyout>
                <Flyout x:Name="AvailableDevicesFlyout" Placement="Bottom" views:AttachProp.IsOpen="False" Opened="AvailableDevicesFlyout_Opened">
                    <Flyout.FlyoutPresenterStyle>
                        <Style TargetType="FlyoutPresenter">
                            <Setter Property="Padding" Value="0" />
                        </Style>
                    </Flyout.FlyoutPresenterStyle>
                    <ListBox x:Name="AvailableDevicesListBox" 
                             ItemsSource="{x:Bind ViewModel.AvailableDevices, Mode=OneWay}" DisplayMemberPath="Description"
                             SelectedItem="{Binding SelectedDevice, Mode=TwoWay}" SelectionChanged="AvailableDevicesListBox_SelectionChanged"
                             Background="{ThemeResource FlyoutBackgroundBrush}" Foreground="{ThemeResource FlyoutForegroundBrush}" 
                             ItemContainerStyle="{ThemeResource FlyoutLisBoxItemStyle}" Width="250"  />
                </Flyout>
            </Button.Flyout>
        </Button>

        <ContentControl Grid.Row="0" Grid.Column="1" IsEnabled="{x:Bind ViewModel.IsBusyHeader, Converter={StaticResource BooleanInverterConverter}, Mode=OneWay}" VerticalAlignment="Center">
            <StackPanel Orientation="Horizontal">
                <Button x:Name="PingButton" Style="{StaticResource PingButtonStyle}" Height="40" Width="40" Margin="5,0" 
                        IsEnabled="{Binding SelectedDevice, Converter={StaticResource TrueWhenNotNullConverter}}"
                        Tapped="{x:Bind ViewModel.SelectedDevicePing, Mode=OneWay}" />
                <!-- IsEnabled="{Binding SelectedDevice, Converter={StaticResource TrueWhenNotNullConverter}}" -->
                <Button x:Name="ConnectDisconnectButton" Style="{StaticResource ConnectDisconnectButtonStyle}" Height="40" Width="40" Margin="5,0,20,0"
                        IsEnabled="{Binding SelectedDevice, Converter={StaticResource TrueWhenNotNullConverter}}"
                        Tapped="{x:Bind ViewModel.ConnectDisconnect, Mode=OneWay}"/>
                <Button x:Name="TransportTypeButton" Margin="10,0"  Style="{StaticResource HeaderButtonStyle}" Height="40" Width="40"               
			            Content="{x:Bind ViewModel.SelectedTransportType, Mode=OneWay}" ContentTemplateSelector="{StaticResource TransportTypeTemplateSelector}" >
                    <Button.Flyout>
                        <Flyout x:Name="AvailableTransportTypesFlyout" Placement="Bottom" views:AttachProp.IsOpen="False" Opened="AvailableTransportTypesFlyout_Opened" >
                            <Flyout.FlyoutPresenterStyle>
                                <Style TargetType="FlyoutPresenter">
                                    <Setter Property="Padding" Value="0" />
                                </Style>
                            </Flyout.FlyoutPresenterStyle>

                            <ListBox x:Name="AvailableTransportTypesListBox"
                                 ItemsSource="{x:Bind ViewModel.AvailableTransportTypes}" 
                                 Background="{StaticResource FlyoutBackgroundBrush}" Foreground="{StaticResource FlyoutForegroundBrush}"
						         ItemTemplateSelector="{StaticResource TransportTypeTemplateSelector}" 
						         SelectedItem="{x:Bind ViewModel.SelectedTransportType, Converter={StaticResource ChangeTypeConverter}, Mode=TwoWay}"
                                 SelectionChanged="AvailableTransportTypesListBox_SelectionChanged" ItemContainerStyle="{StaticResource FlyoutLisBoxItemStyle}"  />
                        </Flyout>
                    </Button.Flyout>
                </Button>
            </StackPanel>
        </ContentControl>
    </Grid>
</UserControl>
